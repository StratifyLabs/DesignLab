set(ICON_FILE  icon.icns)
set(ICON_PATH  ${CMAKE_CURRENT_SOURCE_DIR}/../designlab/assets/${ICON_FILE})
cmsdk2_add_executable(
	NAME ${PROJECT_NAME}
	FLAT
	CONFIG release
	ARCH ${CMSDK_ARCH}
	TARGET RELEASE_TARGET)
cmsdk2_add_sources(
	TARGET ${RELEASE_TARGET}
	DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/src)
cmsdk2_add_sources(
	TARGET ${RELEASE_TARGET}
	DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/src/designlab)
target_sources(${RELEASE_TARGET}
	PRIVATE
	${ICON_PATH})
target_compile_definitions(${RELEASE_TARGET}
	PRIVATE
	-DVERSION=\"${CMAKE_PROJECT_VERSION}\")
target_include_directories(${RELEASE_TARGET}
	PRIVATE
	${CMAKE_CURRENT_SOURCE_DIR}/src)
target_compile_options(${RELEASE_TARGET}
	PRIVATE
	-O3)
set_property(TARGET ${RELEASE_TARGET} PROPERTY CXX_STANDARD 17)
cmsdk2_app_add_dependencies(
	TARGET ${RELEASE_TARGET}
	DEPENDENCIES DesignAPI WindowAPI CPrinterAPI InetAPI JsonAPI SysAPI FsAPI VarAPI ThreadAPI)
set_source_files_properties(${ICON_PATH} PROPERTIES MACOSX_PACKAGE_LOCATION "Resources")
set_target_properties(${RELEASE_TARGET}
	PROPERTIES
	BUNDLE ON
	MACOSX_BUNDLE ON
	MACOSX_BUNDLE_GUI_IDENTIFIER stratifylabs.dev.style.identifier.${RELEASE_TARGET}
	MACOSX_BUNDLE_BUNDLE_NAME "Design Lab"
	MACOSX_BUNDLE_BUNDLE_VERSION "0.1"
	MACOSX_BUNDLE_SHORT_VERSION_STRING "0.1"
	MACOSX_BUNDLE_ICON_FILE ${ICON_FILE}
	MACOSX_BUNDLE_INFO_PLIST ${CMAKE_CURRENT_SOURCE_DIR}/MacOSXBundleInfo.plist.in)
message(STATUS "Code signing identify is $ENV{CODESIGN_IDENTITY}")
add_custom_target(sign
	COMMAND codesign -s $ENV{CODESIGN_IDENTITY} ${BINARY_OUTPUT_DIR}/${RELEASE_TARGET}.app
	VERBATIM)
add_custom_target(verify
	COMMAND spctl --assess -vvvv ${BINARY_OUTPUT_DIR}/${RELEASE_TARGET}.app)

